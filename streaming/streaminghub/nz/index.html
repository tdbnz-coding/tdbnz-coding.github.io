<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Streaming Hub - NZ Channels</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>

<div class="container-fluid">
  <div class="row mt-4">
    <!-- Channel List -->
    <div class="col-md-3">
      <h5>Channel List</h5>
      <ul class="list-group" id="channelList">
        <!-- Channels will be loaded dynamically here -->
      </ul>
    </div>

    <!-- Video Player -->
    <div class="col-md-9">
      <h5>Now Playing</h5>
      <video id="video" controls width="100%" height="auto"></video>
    </div>
  </div>
</div>

<script>
// Load channels from channels.json and initialize the player
fetch('channels.json')
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok: ' + response.statusText);
    }
    return response.json();
  })
  .then(channels => {
    console.log(channels); // Log channels to check if data is loaded correctly
    loadChannelList(channels);
  })
  .catch(error => console.error('Error loading channels:', error));

// Function to load channel list into the HTML
function loadChannelList(channels) {
  const channelListElement = document.getElementById('channelList');
  channels.forEach(channel => {
    const listItem = document.createElement('li');
    listItem.classList.add('list-group-item', 'd-flex', 'align-items-center', 'cursor-pointer');
    listItem.innerHTML = `
      <img src="${channel.logo}" alt="${channel.name}" class="img-thumbnail mr-3" style="width: 50px; height: 50px;">
      <span>${channel.name}</span>
    `;
    listItem.onclick = () => loadStream(channel.stream);
    channelListElement.appendChild(listItem);
  });
}

// Function to load the stream in the video player
function loadStream(streamUrl) {
  const video = document.getElementById('video');
  
  if(Hls.isSupported()) {
    var hls = new Hls();
    hls.loadSource(streamUrl);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, function() {
      video.play();
    });
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = streamUrl;
    video.addEventListener('canplay', function() {
      video.play();
    });
  }
}
</script>

</body>
</html>
