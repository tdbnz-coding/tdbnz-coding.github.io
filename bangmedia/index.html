<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bang Media</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container my-5">
  <h1 class="text-center">Bang Media Server Status</h1>
  <input id="searchInput" class="form-control my-3" type="text" placeholder="Search for titles..." onkeyup="searchPlexData()">

  <h2>Active Users</h2>
  <div id="active-sessions" class="row mb-5"></div>

  <h2>Library Contents</h2>
  <div id="libraries" class="row"></div>
</div>

<script>
  async function loadPlexData() {
    const response = await fetch('plex_data.json');
    const plexData = await response.json();
    displayActiveSessions(plexData.active_sessions);
    displayLibraries(plexData.libraries);
  }

  function displayActiveSessions(sessions) {
    const activeSessionsDiv = document.getElementById('active-sessions');
    activeSessionsDiv.innerHTML = '';

    sessions.forEach(session => {
      const sessionDiv = document.createElement('div');
      sessionDiv.className = 'col-md-4 mb-4';
      sessionDiv.innerHTML = `
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">${session.User.title}</h5>
            <p class="card-text">Watching: ${session.title}</p>
            <p class="card-text">Type: ${session.type}</p>
            <p class="card-text">Status: ${session.Player.state}</p>
          </div>
        </div>`;
      activeSessionsDiv.appendChild(sessionDiv);
    });
  }

  function displayLibraries(libraries) {
    const librariesDiv = document.getElementById('libraries');
    librariesDiv.innerHTML = '';

    libraries.forEach(library => {
      library.items.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'col-md-4 mb-4';
        itemDiv.innerHTML = `
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">${item.title || 'Untitled'}</h5>
              <p class="card-text">Type: ${library.type}</p>
              <p class="card-text">Year: ${item.year || 'Unknown'}</p>
            </div>
          </div>`;
        librariesDiv.appendChild(itemDiv);
      });
    });
  }

  function searchPlexData() {
    const input = document.getElementById('searchInput').value.toLowerCase();
    displayLibraries(plexData.libraries.filter(library => library.items.some(item => item.title.toLowerCase().includes(input))));
  }

  loadPlexData();
</script>

</body>
</html>
